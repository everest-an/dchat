# dChat 产品功能文档

**版本**: 2.0
**日期**: 2026年1月9日

## 1. 简介

dChat是一个基于Web3技术的去中心化安全通信平台，专为需要高度隐私和安全性的商业通信场景设计。它利用区块链钱包作为身份认证手段，提供端到端的加密消息传递和去中心化身份验证功能。

### 1.1 愿景

我们的愿景是打造一个无需信任、抗审查、用户数据主权自主的下一代通信网络。通过dChat，用户可以安全地进行商业交流、协作和价值交换，而无需依赖传统的中心化服务提供商。

### 1.2 核心理念

- **去中心化**: 无中心服务器控制用户数据和通信。
- **安全性**: 利用密码学和区块链技术确保通信安全。
- **用户主权**: 用户完全控制自己的身份和数据。
- **高性能**: 采用Go语言构建后端，确保实时通信的低延迟和高并发。

## 2. 核心功能

### 2.1 Web3钱包认证

dChat采用无密码认证系统，用户通过其Web3钱包（如MetaMask）进行身份验证。

| 功能点 | 描述 | 技术实现 |
|---|---|---|
| **无密码登录** | 用户无需注册或记住密码，直接使用钱包签名登录。 | 1. 前端请求一个唯一的`nonce`。 2. 用户使用钱包私钥对`nonce`进行签名。 3. 后端验证签名，验证通过后下发JWT。 |
| **会话管理** | 使用JWT (JSON Web Token) 进行安全的会话管理。 | JWT包含用户ID和过期时间，所有受保护的API请求都需要在Header中携带此Token。 |
| **安全性** | 防止重放攻击和中间人攻击。 | 每个`nonce`只能使用一次，签名过程在本地完成，私钥不离开用户设备。 |

### 2.2 实时去中心化聊天

提供一对一的实时消息传递功能，所有通信都通过安全的WebSocket连接进行。

| 功能点 | 描述 | 技术实现 |
|---|---|---|
| **一对一消息** | 用户可以通过对方的钱包地址直接发起对话。 | 后端通过WebSocket维护用户连接，实现消息的实时推送和接收。 |
| **开放式聊天** | 无需“加好友”即可开始对话，简化了社交流程。 | 任何有效的钱包地址都可以成为通信对象。 |
| **对话管理** | 用户可以查看所有历史对话列表。 | API (`/api/conversations`) 返回与当前用户相关的所有对话，按最新消息排序。 |
| **消息历史** | 用户可以加载与特定用户的历史消息。 | API (`/api/messages/:user_id`) 提供分页加载的聊天记录。 |
| **已读状态** | 系统可以标记消息的已读状态。 | API (`/api/messages/read/:sender_id`) 用于更新消息的读取状态。 |

### 2.3 去中心化身份 (DID) 与验证

dChat集成了Privado ID，一个去中心化的身份验证框架，允许用户在保护隐私的前提下验证其身份信息。

| 功能点 | 描述 | 技术实现 |
|---|---|---|
| **可验证凭证** | 用户可以申请并管理多种类型的可验证凭证。 | API (`/api/verifications/request`) 用于创建验证请求。 |
| **验证类型** | 支持多种身份维度的验证。 | API (`/api/verifications/types`) 返回支持的验证类型，如：<br>- 公司隶属关系<br>- 项目参与<br>- 专业技能<br>- 教育背景<br>- 真人证明 |
| **隐私保护** | 验证过程使用零知识证明，保护用户隐私。 | 后端验证证明的有效性，而无需访问用户的原始数据。 |

## 3. 系统架构

dChat采用前后端分离的现代架构，旨在实现高性能、高可用和易于维护。

### 3.1 架构图

```
用户
  ↓
dchat.pro (Vercel CDN)
  ↓
  ├─ 前端请求 → Vercel (React应用)
  ↓
  └─ API请求 (/api/*) → Vercel Rewrites → AWS EC2
                                              ↓
                                         Go API Server (端口8080)
                                         Go WebSocket (端口8081)
```

### 3.2 技术栈

| 模块 | 技术 | 托管平台 | 职责 |
|---|---|---|---|
| **前端** | React, Vite, TailwindCSS | Vercel | 提供用户界面和交互体验。 |
| **后端API** | Go, Gin | AWS EC2 | 处理业务逻辑、数据库交互和身份认证。 |
| **实时通信** | Go, WebSocket | AWS EC2 | 维护长连接，实现消息的实时推送。 |
| **反向代理** | Nginx | AWS EC2 | SSL终止，负载均衡，路由请求。 |
| **数据库** | PostgreSQL | AWS RDS (推荐) | 存储用户信息、消息和对话数据。 |

## 4. 潜在功能 (待开发)

基于对现有代码库（包括Python后端）的分析，dChat具备扩展以下功能的潜力：

- **群组聊天**: 创建和管理多人聊天群组。
- **WebRTC音视频通话**: 提供点对点的加密音视频通信。
- **好友系统**: 传统的添加/接受/拒绝好友请求功能。
- **用户搜索与发现**: 允许用户按用户名或钱包地址搜索其他用户。
- **加密货币支付**: 在聊天中集成加密货币转账和托管支付功能。
- **表情包/贴纸商店**: 允许用户购买和使用自定义表情包。

这些功能可以作为未来版本迭代的重点。
